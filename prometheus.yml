global:
  scrape_interval: 60s
  evaluation_interval: 60s

scrape_configs:
  # Job 1: Quét Prometheus và Exporter (để kiểm tra trạng thái)
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090', 'snmp-exporter:9116']

  # Job 2: Quét Router thông qua SNMP Exporter
  - job_name: 'snmp_router_test'
    scrape_timeout: 10s
    
    # Target thực tế (IP Router)
    static_configs:
      - targets: ['10.250.224.31:161'] # <-- CẬP NHẬT: IP Router của bạn
        labels:
          device_name: 'TEST-RTR-01'
          
    # Cấu hình chuyển hướng tới SNMP Exporter
    relabel_configs:
      # 1. Ghi đè __address__ bằng địa chỉ của SNMP Exporter
      - source_labels: [__address__]
        target_label: __address__
        replacement: snmp-exporter:9116 # <-- Tên dịch vụ Docker

      # 2. Lưu IP Router thực tế vào __param_target
      - source_labels: [__address__]
        target_label: __param_target
        regex: (.*):.*
        replacement: $1
        
      # 3. Chỉ định module SNMP cần dùng
      - target_label: __param_module
        replacement: router_inventory # <-- Sử dụng module Inventory

      # 4. Đặt tên instance
      - source_labels: [device_name]
        target_label: instance